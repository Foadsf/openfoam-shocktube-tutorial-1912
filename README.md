# OpenFOAM 1D Shock Tube Tutorial (v1912)

## Repository Description
This repository contains a complete replication and study of a 1D shock tube problem using OpenFOAM v1912. The setup is primarily based on the CFD final project "Shock Tube with rhoCentralFoam, sonicFoam, Lax-Friedrichs and MacCormacks" by Ankush Gupta (Boston University, ENG ME702, Fall 2016). This repository includes the OpenFOAM case files, notes on setting up OpenFOAM on WSL (Windows Subsystem for Linux) with Ubuntu 22.04, comprehensive lessons learned during the replication process, and multiple visualization approaches.

## Original Work Acknowledgement
This work is heavily based on the educational project by **Ankush Gupta**.
*   **Original Report**: "Shock Tube with rhoCentralFoam, sonicFoam, Lax-Friedrichs and MacCormacks" (Ankush_Sod_report.pdf, included in the `docs` or `reference` directory of this repository if available, or as per its original source).
*   The efforts here are for learning and demonstration purposes, aiming to replicate and understand the setup within a slightly different OpenFOAM version and environment.

## License
This repository is licensed under the **GNU General Public License v3.0 or later** (see LICENSE file). OpenFOAM itself is distributed under the GPL.

## Directory Structure
```
.
├── 0.org/              # Template initial condition files (committed to repo)
├── 0/                  # Working initial condition files (generated from 0.org)
├── Allclean            # Script to clean simulation results
├── Allrun              # Script to run the full simulation workflow
├── constant/
│   ├── polyMesh/       # (Generated by blockMesh) Mesh files
│   ├── thermophysicalProperties
│   └── turbulenceProperties
├── results/            # Analysis results and visualization
│   ├── plots/          # Generated plots and figures
│   └── scripts/        # Plotting and analysis scripts
├── system/
│   ├── blockMeshDict
│   ├── controlDict     # Includes separate sampling function objects
│   ├── fvSchemes
│   ├── fvSolution
│   └── sampleDict
├── myShockTube.foam    # ParaView compatibility file
├── LICENSE             # GPL-3.0-or-later license text
└── README.md           # This file
```

## WSL and OpenFOAM v1912 Setup Notes

These notes document the process used to set up the environment for running this simulation.

1.  **Install WSL and Ubuntu:**
    ```bash
    wsl --install -d Ubuntu-22.04
    ```
    Launch the Ubuntu distribution.

2.  **Update System and Install OpenFOAM:**
    ```bash
    sudo apt update && sudo apt upgrade -y
    sudo apt install openfoam -y
    ```
    This typically installs the OpenFOAM.com community version (v1912 was installed at the time of this setup).

3.  **Configure OpenFOAM Environment:**
    The OpenFOAM environment needs to be sourced in your shell. The `bashrc` file for OpenFOAM v1912 installed via `apt` on Ubuntu 22.04 is located at `/usr/share/openfoam/etc/bashrc`.
    ```bash
    echo "source /usr/share/openfoam/etc/bashrc" >> ~/.bashrc
    source ~/.bashrc
    ```

4.  **Workaround for Dummy Scripts (Potentially Unnecessary for Standard Installations):**
    During initial setup, issues were encountered where certain environment scripts expected by older OpenFOAM versions or different distributions were not found or behaved differently. Dummy scripts were created as a temporary workaround. **Note:** These might not be necessary if the `apt` installation provides a complete environment. The critical part is that the main OpenFOAM executables (`blockMesh`, `sonicFoam`, `postProcess`, etc.) are correctly found in the `$PATH`.

## Simulation Workflow

The simulation is managed by the `Allrun` script, which performs the following steps:
1.  **`./Allclean`**: Cleans previous simulation results and restores the `0/` directory from `0.org/`.
2.  **`blockMesh`**: Generates the 1D mesh based on `system/blockMeshDict`.
3.  **`setFields`**: Initializes the high and low-pressure/temperature regions in the `0/` directory based on `system/setFieldsDict`.
4.  **`sonicFoam`**: Runs the compressible flow solver with integrated sampling function objects.
5.  **`postProcess`**: Executes function objects defined in `system/controlDict` for data sampling.

## Data Extraction and Analysis

### Sampling Configuration
The case uses separate function objects for clean data extraction:
- **`temperatureSampling`**: Extracts temperature data to `postProcessing/temperatureSampling/`
- **`velocitySampling`**: Extracts velocity components to `postProcessing/velocitySampling/`
- **`pressureSampling`**: Extracts pressure data to `postProcessing/pressureSampling/`

Each function object generates CSV files with clear headers for easy analysis.

### Output Files
After running the simulation, the following data files are generated:
- `postProcessing/temperatureSampling/0.007/data_T.csv` - Temperature distribution
- `postProcessing/velocitySampling/0.007/data_U.csv` - Velocity components (U_0, U_1, U_2)
- `postProcessing/pressureSampling/0.007/data_p.csv` - Pressure distribution

## Visualization Methods

### 1. ParaView (Recommended for 3D Visualization)
```bash
# On Windows (if ParaView installed via winget)
paraview.exe myShockTube.foam

# Navigate to: \\wsl.localhost\Ubuntu-22.04\home\user\path\to\case
```

**ParaView Workflow:**
1. Click "Apply" to load the mesh
2. Change coloring from "Solid Color" to desired field (p, T, U)
3. Use "Plot Over Line" filter for 1D line plots
4. Animate through timesteps to see shock wave propagation

### 2. Python Visualization (Publication Quality)
A simple Python script is provided for creating publication-quality plots:

```bash
cd results/scripts
python3 plotSimple.py
```

This generates multi-panel plots showing temperature, pressure, velocity magnitude, and normalized comparison.

### 3. Alternative VTK Export
OpenFOAM can export VTK files for use with other visualization tools:
```bash
foamToVTK  # Generates VTK/ directory with .vtu files
```

## Lessons Learned and Known Issues

### 1. **Function Objects for Field Calculation**
**Issue**: Various approaches to calculate velocity magnitude (`magU`) field failed:
- `coded` function objects were overly complex and unreliable
- `fieldExpression` and `expressionField` had compatibility issues
- `foamCalc` utility was not available in the WSL OpenFOAM installation

**Solution**: Calculate velocity magnitude during post-processing:
```python
magU = np.sqrt(U_data['U_0']**2 + U_data['U_1']**2 + U_data['U_2']**2)
```

### 2. **Sampling Function Objects**
**Key Findings**:
- The `sets` function object with `raw` format groups scalar fields together by default
- Using separate function objects for each field provides cleaner data organization
- CSV format with separate function objects gives individual files with proper headers
- Warning messages about "Cannot find registered field" are harmless when `postProcess` re-executes after solver completion

**Working Configuration**:
- Separate function objects for T, U, and p in `system/controlDict`
- CSV output format for clear data structure
- Execution during solver runtime, not just post-processing

### 3. **Visualization Tools Compatibility**
**ParaView**: 
- ✅ Works excellently on Windows accessing WSL files via `\\wsl.localhost\`
- ❌ Direct installation in WSL often has Qt5 dependency issues

**Gnuplot**:
- ❌ GUI version conflicts with Qt5 in WSL
- ✅ Use `gnuplot-nox` (non-X11 version) for headless plotting

**Python/Matplotlib**:
- ✅ Works reliably for 1D line plots and publication figures
- ❌ NumPy 2.x compatibility issues with system matplotlib
- **Fix**: Use numpy<2.0 or pure numpy without pandas

### 4. **File Organization and Version Control**
**Important Git Considerations**:
- `0.org/` should be committed as template initial conditions
- `0/` is generated from `0.org/` and should be ignored
- `postProcessing/` and `VTK/` directories should be ignored
- Result plots and scripts organized in `results/` directory
- `.foam` file should be committed for ParaView compatibility

### 5. **OpenFOAM v1912 Specific Notes**
**Deprecated Keywords**:
- `convertToMeters` → use `scale` in `blockMeshDict`
- `outputControl` → use `writeControl` in function objects
- `functionObjectLibs` → use `libs` in function objects

**Missing Utilities**:
- `foamCalc` not available in WSL installation
- `sample` standalone utility not found
- Use `postProcess` with function objects instead

## Results Validation

The simulation produces physically correct shock tube behavior:
- **Shock wave**: Sharp pressure and temperature discontinuity propagating rightward
- **Contact discontinuity**: Temperature jump without pressure change
- **Rarefaction wave**: Gradual pressure decrease on the left side
- **Velocity development**: Gas acceleration to ~300 m/s in the middle region

Values match expected Sod shock tube initial conditions:
- Left state: p₁ = 100 kPa, T₁ = 348.4 K
- Right state: p₄ = 10 kPa, T₄ = 278.7 K

## How to Run

1.  Ensure OpenFOAM v1912 (or a compatible version) is installed and the environment is sourced:
    ```bash
    source /usr/share/openfoam/etc/bashrc
    ```

2.  Clone this repository and navigate to the case directory:
    ```bash
    git clone <repository-url>
    cd openfoam-shocktube-tutorial-1912
    ```

3.  Make the scripts executable and run:
    ```bash
    chmod +x Allrun Allclean
    ./Allrun
    ```

4.  Visualize results:
    ```bash
    # Python plotting
    cd results/scripts
    python3 plotSimple.py
    
    # ParaView (on Windows)
    paraview.exe myShockTube.foam
    ```

## Future Work / Improvements

*   Implement comparison with analytical Sod shock tube solution
*   Add automated result validation scripts
*   Create time-series animation generation scripts
*   Explore alternative turbulence models and their effects
*   Add mesh sensitivity analysis
*   Document comparison with other OpenFOAM solvers (rhoCentralFoam)

## Contributing

This repository serves as an educational resource. Contributions that improve documentation, add alternative solution methods, or enhance visualization are welcome. Please ensure any modifications maintain compatibility with OpenFOAM v1912 and include appropriate documentation updates.
